version: 2.1

jobs:
  build-and-test:
    docker:
      - image: circleci/openjdk:11

    steps:
      - checkout

      # Install Chrome browser and ChromeDriver
      - run:
          name: Install Chrome and ChromeDriver
          command: |
            sudo apt-get update
            sudo apt-get install -y wget unzip
            wget -N https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
            sudo dpkg -i google-chrome-stable_current_amd64.deb
            CHROME_VERSION=$(google-chrome --version | awk '{print $3}' | cut -d '.' -f 1)
            CHROMEDRIVER_VERSION=$(curl -sS chromedriver.storage.googleapis.com/LATEST_RELEASE_${CHROME_VERSION})
            wget -N "https://chromedriver.storage.googleapis.com/${CHROMEDRIVER_VERSION}/chromedriver_linux64.zip"
            unzip chromedriver_linux64.zip
            sudo mv chromedriver /usr/local/bin
            sudo chmod +x /usr/local/bin/chromedriver

      # Install Maven
      - run:
          name: Install Maven
          command: sudo apt-get install -y maven

      # Build and test Maven project
      - run:
          name: Build and test
          command: mvn -B clean test

workflows:
  version: 2
  build:
    jobs:
      - build-and-test
